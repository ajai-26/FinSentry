<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fraud Detection Interface</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        /* Simple transition for a smoother appearance */
        #result-container {
            transition: opacity 0.5s ease-in-out;
        }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen p-4">
    <div class="bg-white rounded-lg shadow-xl p-6 md:p-8 w-full max-w-4xl">
        <div class="text-center mb-6">
            <h1 class="text-3xl font-bold text-gray-800">Real-Time Transaction Fraud Detector</h1>
            <p class="text-gray-500 mt-2">Enter the transaction features below to get a live prediction from the model.</p>
        </div>
        
        <div id="form-container">
            <!-- Grid for input fields -->
            <div class="grid grid-cols-2 md:grid-cols-5 gap-4 mb-6" id="input-grid">
                <!-- Input fields are dynamically generated by JavaScript -->
            </div>

            <!-- Buttons and Action Center -->
            <div class="flex flex-col items-center">
                <button id="predict-btn" class="w-full md:w-1/2 bg-indigo-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-opacity-50 transition duration-300">
                    Check Transaction
                </button>
                <div class="mt-4 flex space-x-2">
                     <button onclick="populateSample('normal')" class="text-xs bg-gray-200 text-gray-700 px-3 py-1 rounded-md hover:bg-gray-300 transition">Populate Normal Sample</button>
                     <button onclick="populateSample('fraud')" class="text-xs bg-gray-200 text-gray-700 px-3 py-1 rounded-md hover:bg-gray-300 transition">Populate Fraud Sample</button>
                </div>
            </div>
        </div>

        <!-- Result Display Area -->
        <div id="result-container" class="mt-6 text-center opacity-0 h-0">
             <!-- Prediction result will be displayed here -->
        </div>
    </div>

    <script>
        // --- SETUP ---
        const formGrid = document.getElementById('input-grid');
        const predictBtn = document.getElementById('predict-btn');
        const resultContainer = document.getElementById('result-container');
        
        // The exact order of features your model expects
        const featureNames = [
            'Amount', 'V1', 'V2', 'V3', 'V4', 'V5', 'V6', 'V7', 'V8', 'V9', 'V10', 
            'V11', 'V12', 'V13', 'V14', 'V15', 'V16', 'V17', 'V18', 'V19', 'V20', 
            'V21', 'V22', 'V23', 'V24', 'V25', 'V26', 'V27', 'V28'
        ];

        // --- DYNAMICALLY CREATE INPUT FIELDS ---
        featureNames.forEach(name => {
            const div = document.createElement('div');
            div.innerHTML = `
                <label for="${name}" class="block text-sm font-medium text-gray-700">${name}</label>
                <input type="text" id="${name}" name="${name}" class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm transition">
            `;
            formGrid.appendChild(div);
        });

        // --- PREDICTION LOGIC ---
        predictBtn.addEventListener('click', async () => {
            const transactionData = {};
            let isValid = true;

            // Collect and validate data from all input fields
            featureNames.forEach(name => {
                const input = document.getElementById(name);
                const value = parseFloat(input.value);
                if (isNaN(value)) {
                    input.classList.add('border-red-500');
                    isValid = false;
                } else {
                    input.classList.remove('border-red-500');
                    transactionData[name] = value;
                }
            });

            if (!isValid) {
                alert("Please fill in all fields with valid numbers.");
                return;
            }

            // Show a "loading" state
            resultContainer.innerHTML = `<div class="p-4 rounded-lg bg-yellow-100 text-yellow-800">Checking...</div>`;
            resultContainer.classList.remove('opacity-0', 'h-0');

            // Send data to the Flask backend
            try {
                const response = await fetch('/predict', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(transactionData)
                });
                const result = await response.json();

                // Display the result from the backend
                if (result.isFraud) {
                    resultContainer.innerHTML = `
                        <div class="p-4 rounded-lg bg-red-100 text-red-800">
                            <h3 class="font-bold text-lg">FRAUDULENT TRANSACTION DETECTED</h3>
                            <p class="text-sm">Model's Confidence (Probability of Fraud): ${(result.probability * 100).toFixed(2)}%</p>
                        </div>
                    `;
                } else {
                    resultContainer.innerHTML = `
                        <div class="p-4 rounded-lg bg-green-100 text-green-800">
                            <h3 class="font-bold text-lg">Transaction Appears Normal</h3>
                            <p class="text-sm">Model's Confidence (Probability of Fraud): ${(result.probability * 100).toFixed(2)}%</p>
                        </div>
                    `;
                }
            } catch (error) {
                console.error("Error:", error);
                resultContainer.innerHTML = `<div class="p-4 rounded-lg bg-gray-200 text-gray-800">Error: Could not connect to the model. Is the 'py app.py' server running in your terminal?</div>`;
            }
        });

        // --- SAMPLE DATA ---
        function populateSample(type) {
             const fraudSample = {'Amount': 1.0, 'V1': -2.312226542, 'V2': 1.951992011, 'V3': -1.609850732, 'V4': 3.997905588, 'V5': -0.522187865, 'V6': -1.426545318, 'V7': -2.537387306, 'V8': 1.391657248, 'V9': -2.770089273, 'V10': -2.772272145, 'V11': 3.202033207, 'V12': -2.899807334, 'V13': -0.595221881, 'V14': -4.289253782, 'V15': 0.38972412, 'V16': -1.14074718, 'V17': -2.830055675, 'V18': -0.016822468, 'V19': 0.416955705, 'V20': 0.126910559, 'V21': 0.517232371, 'V22': -0.035049369, 'V23': -0.465211076, 'V24': 0.320198199, 'V25': 0.044519167, 'V26': 0.177839798, 'V27': 0.261145003, 'V28': -0.143275875};
             const normalSample = {'Amount': 12.99, 'V1': 1.191857111, 'V2': 0.266150712, 'V3': 0.166480113, 'V4': 0.448154078, 'V5': 0.060017649, 'V6': -0.082360809, 'V7': -0.078802848, 'V8': 0.085101655, 'V9': -0.255425126, 'V10': -0.166974433, 'V11': 1.612726662, 'V12': 1.065235311, 'V13': 0.489095014, 'V14': -0.143772296, 'V15': 0.63555806, 'V16': 0.463917033, 'V17': -0.114804655, 'V18': -0.183361273, 'V19': -0.145783041, 'V20': -0.069083133, 'V21': -0.225775248, 'V22': -0.638671953, 'V23': 0.101288022, 'V24': -0.339846476, 'V25': 0.167170406, 'V26': 0.125894543, 'V27': -0.008983099, 'V28': 0.014724139};
            const sample = type === 'fraud' ? fraudSample : normalSample;
            for (const key in sample) {
                const input = document.getElementById(key);
                if(input) {
                    input.value = sample[key];
                    input.classList.remove('border-red-500');
                }
            }
            resultContainer.classList.add('opacity-0', 'h-0');
        }
    </script>
</body>
</html>

